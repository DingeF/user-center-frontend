{"version":3,"sources":["src/pages/user/register/index.tsx"],"sourcesContent":["import { Footer } from '@/components';\r\nimport { register} from '@/services/ant-design-pro/api';\r\nimport {\r\n  AlipayCircleOutlined,\r\n  LockOutlined,\r\n  MobileOutlined,\r\n  TaobaoCircleOutlined, UserAddOutlined,\r\n  UserOutlined,\r\n  WeiboCircleOutlined,\r\n} from '@ant-design/icons';\r\nimport {\r\n  LoginForm,\r\n  ProFormText,\r\n} from '@ant-design/pro-components';\r\nimport { Helmet, history } from '@umijs/max';\r\nimport {Alert, App, Button, Space, Tabs} from 'antd';\r\nimport { createStyles } from 'antd-style';\r\nimport React, { useState } from 'react';\r\nimport Settings from '../../../../config/defaultSettings';\r\nimport {PLANT_DOC, SYSTEM_LOGO} from \"@/constants\";\r\nconst useStyles = createStyles(({ token }) => {\r\n  return {\r\n    action: {\r\n      marginLeft: '8px',\r\n      color: 'rgba(0, 0, 0, 0.2)',\r\n      fontSize: '24px',\r\n      verticalAlign: 'middle',\r\n      cursor: 'pointer',\r\n      transition: 'color 0.3s',\r\n      '&:hover': {\r\n        color: token.colorPrimaryActive,\r\n      },\r\n    },\r\n    lang: {\r\n      width: 42,\r\n      height: 42,\r\n      lineHeight: '42px',\r\n      position: 'fixed',\r\n      right: 16,\r\n      borderRadius: token.borderRadius,\r\n      ':hover': {\r\n        backgroundColor: token.colorBgTextHover,\r\n      },\r\n    },\r\n    container: {\r\n      display: 'flex',\r\n      flexDirection: 'column',\r\n      height: '100vh',\r\n      overflow: 'auto',\r\n      backgroundImage:\r\n        \"url('https://mdn.alipayobjects.com/yuyan_qk0oxh/afts/img/V-_oS6r-i7wAAAAAAAAAAAAAFl94AQBr')\",\r\n      backgroundSize: '100% 100%',\r\n    },\r\n  };\r\n});\r\nconst ActionIcons = () => {\r\n  const { styles } = useStyles();\r\n  return (\r\n    <>\r\n      <AlipayCircleOutlined key=\"AlipayCircleOutlined\" className={styles.action} />\r\n      <TaobaoCircleOutlined key=\"TaobaoCircleOutlined\" className={styles.action} />\r\n      <WeiboCircleOutlined key=\"WeiboCircleOutlined\" className={styles.action} />\r\n    </>\r\n  );\r\n};\r\nconst Lang = () => {\r\n  const { styles } = useStyles();\r\n  return;\r\n};\r\nconst LoginMessage: React.FC<{\r\n  content: string;\r\n}> = ({ content }) => {\r\n  return (\r\n    <Alert\r\n      style={{\r\n        marginBottom: 24,\r\n      }}\r\n      message={content}\r\n      type=\"error\"\r\n      showIcon\r\n    />\r\n  );\r\n};\r\nconst Register: React.FC = () => {\r\n  const [userLoginState, setUserLoginState] = useState<API.LoginResult>({});\r\n  const [type, setType] = useState<string>('account');\r\n  const { styles } = useStyles();\r\n  const { message } = App.useApp();\r\n  const handleSubmit = async (values: API.RegisterParams) => {\r\n    const { userPassword, checkPassword} = values;\r\n    // 校验\r\n    if(userPassword !== checkPassword) {\r\n      const defaultLoginFailureMessage = '注册失败，两次输入密码不相同！'\r\n      message.error(defaultLoginFailureMessage);\r\n      return\r\n    }\r\n    let defaultErrorMessage = '';\r\n    try {\r\n      // 调用注册接口\r\n      const res = await register({\r\n        ...values,\r\n        type,\r\n      });\r\n      if (res.code === 0  && res.data != null && res.data > 0) {\r\n        const defaultLoginSuccessMessage = '注册成功！';\r\n        message.success(defaultLoginSuccessMessage);\r\n\r\n        // 跳转到登录页面\r\n        const query = history.location;\r\n        const LoginPath = '/user/login'\r\n        // 跳转到登录页；history.push 不支持传入 query 字段\r\n        // 如需附加查询参数，请使用 search：\r\n        // history.push({ pathname: LoginPath, search: `?from=register` })\r\n        history.push(LoginPath);\r\n\r\n        return;\r\n      }else{\r\n        defaultErrorMessage = '注册失败!' + res?.description || '注册失败!' + res?.msg ||'注册失败!';\r\n        throw Error(`注册失败，请重试！${res?.description || res?.msg ||''}`);\r\n      }\r\n      // 如果失败去设置用户错误信息\r\n      // setUserLoginState(user_id);\r\n    } catch (error) {\r\n      console.log(error);\r\n      message.error(defaultErrorMessage);\r\n    }\r\n  };\r\n  const { status, type: loginType } = userLoginState;\r\n  return (\r\n    <div className={styles.container}>\r\n      <Helmet>\r\n        <title>\r\n          {'注册'}\r\n          {Settings.title && ` - ${Settings.title}`}\r\n        </title>\r\n      </Helmet>\r\n      <Lang />\r\n      <div\r\n        style={{\r\n          flex: '1',\r\n          padding: '32px 0',\r\n        }}\r\n      >\r\n        <LoginForm\r\n          submitter={{\r\n           searchConfig:{\r\n             submitText:\"注册\"\r\n           }\r\n          }\r\n          }\r\n          contentStyle={{\r\n            minWidth: 280,\r\n            maxWidth: '75vw',\r\n          }}\r\n          logo={<img alt=\"logo\" src={SYSTEM_LOGO} />}\r\n          title=\"用户注册\"\r\n          subTitle={<a href={PLANT_DOC} target=\"_blank\">编程学习社交圈子</a>}\r\n          actions={\r\n            <Space style={{justifyContent: 'flex-end', width: '100%'}}>\r\n              <Button\r\n                type=\"default\"\r\n                size=\"small\"\r\n                icon={<UserAddOutlined/>}\r\n                onClick={() => history.push('/user/login')}\r\n              >\r\n                返回\r\n              </Button>\r\n            </Space>\r\n          }\r\n          initialValues={{\r\n            autoLogin: true,\r\n          }}\r\n          onFinish={async (values) => {\r\n            await handleSubmit(values as API.RegisterParams);\r\n          }}\r\n        >\r\n          <Tabs\r\n            activeKey={type}\r\n            onChange={setType}\r\n            centered\r\n            items={[\r\n              {\r\n                key: 'account',\r\n                label: '账户密码注册',\r\n              }\r\n            ]}\r\n          />\r\n\r\n          {status === 'error' && loginType === 'account' && (\r\n            <LoginMessage content={'错误的账户和密码'} />\r\n          )}\r\n          {type === 'account' && (\r\n            <>\r\n              <ProFormText\r\n                name=\"userAccount\"\r\n                fieldProps={{\r\n                  size: 'large',\r\n                  prefix: <UserOutlined />,\r\n                }}\r\n                placeholder={'请输入账户'}\r\n                rules={[\r\n                  {\r\n                    required: true,\r\n                    message: '账户是必填项！',\r\n                  },\r\n                ]}\r\n              />\r\n              <ProFormText\r\n                name=\"plantCode\"\r\n                fieldProps={{\r\n                  size: 'large',\r\n                  prefix: <UserOutlined />,\r\n                }}\r\n                placeholder={'请输入编号'}\r\n                rules={[\r\n                  {\r\n                    required: true,\r\n                    message: '星球编号是必填项！',\r\n                  },\r\n                ]}\r\n              />\r\n              <ProFormText.Password\r\n                name=\"userPassword\"\r\n                fieldProps={{\r\n                  size: 'large',\r\n                  prefix: <LockOutlined />,\r\n                }}\r\n                placeholder={'请输入密码'}\r\n                rules={[\r\n                  {\r\n                    required: true,\r\n                    message: '密码是必填项！',\r\n                  },\r\n                  {\r\n                    min: 8,\r\n                    type:\"string\",\r\n                    message: '密码长度不小于8！',\r\n                  },\r\n                ]}\r\n              />\r\n              <ProFormText.Password\r\n                name=\"checkPassword\"\r\n                fieldProps={{\r\n                  size: 'large',\r\n                  prefix: <LockOutlined />,\r\n                }}\r\n                placeholder={'请再次输入密码'}\r\n                rules={[\r\n                  {\r\n                    required: true,\r\n                    message: '确认密码是必填项！',\r\n                  },\r\n                  {\r\n                    min: 8,\r\n                    type:\"string\",\r\n                    message: '密码长度不小于8！',\r\n                  },\r\n                ]}\r\n              />\r\n\r\n            </>\r\n          )}\r\n\r\n          {status === 'error' && loginType === 'mobile' && <LoginMessage content=\"验证码错误\" />}\r\n          <div\r\n            style={{\r\n              marginBottom: 24,\r\n            }}\r\n          >\r\n          </div>\r\n        </LoginForm>\r\n      </div>\r\n      <Footer />\r\n    </div>\r\n  );\r\n};\r\nexport default Register;\r\n"],"names":[],"mappings":"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"}