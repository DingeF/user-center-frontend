{"version":3,"sources":["src/pages/Admin/UserManage/index.tsx"],"sourcesContent":["import React, {useState} from 'react';\r\nimport {PlusOutlined} from '@ant-design/icons';\r\nimport type {ActionType, ProColumns} from '@ant-design/pro-components';\r\nimport {ProTable, TableDropdown} from '@ant-design/pro-components';\r\nimport {Button, Dropdown, Space, Tag, Image} from 'antd';\r\nimport {useRef} from 'react';\r\nimport {queryUserList} from \"@/services/ant-design-pro/api\";\r\n\r\nexport const waitTimePromise = async (time: number = 100) => {\r\n  return new Promise((resolve) => {\r\n    setTimeout(() => {\r\n      resolve(true);\r\n    }, time);\r\n  });\r\n};\r\n\r\nexport const waitTime = async (time: number = 100) => {\r\n  await waitTimePromise(time);\r\n};\r\n\r\nconst columns: ProColumns<API.CurrentUser>[] = [\r\n  {\r\n    dataIndex: 'id',  // dataIndex:将表格列名与数据库字段名匹配上即可\r\n    valueType: 'indexBorder',\r\n    width: 48,\r\n  },\r\n  {\r\n    title: '用户账户',\r\n    dataIndex: 'userAccount',\r\n    copyable: true,\r\n  },\r\n  {\r\n    title: '用户名',\r\n    dataIndex: 'username',\r\n    filters: true,\r\n    onFilter: true,\r\n  },\r\n  {\r\n    title: '用户头像',\r\n    dataIndex: 'avatarUrl',\r\n    search: false,\r\n    render: (_, record) => (\r\n      <Image\r\n        src={record.avatarUrl}\r\n        width={56}\r\n        height={56}\r\n        style={{ borderRadius: '50%', objectFit: 'cover' }}\r\n        preview={{ src: record.avatarUrl }}\r\n      />\r\n    ),\r\n  },\r\n  {\r\n    title: '性别',\r\n    key: 'showTime',\r\n    dataIndex: 'gender',\r\n    search: true,\r\n    valueType:\"select\",\r\n    fieldProps: {\r\n      options: [\r\n        {label:\"男\",value:\"1\"},\r\n        {label: \"女\",value:\"0\"},\r\n      ]\r\n    },\r\n   },\r\n  {\r\n    title: '电话',\r\n    dataIndex: 'phone',\r\n  },\r\n  {\r\n    title: '邮箱',\r\n    dataIndex: 'email',\r\n  },\r\n  {\r\n    title: '用户状态',\r\n    dataIndex: 'userStatus',\r\n    valueType: 'select',\r\n    fieldProps:{\r\n      options: [\r\n        {label:'正常',value:\"0\"},\r\n        {label: '非正常',value:\"1\"},\r\n      ]\r\n    }\r\n  },\r\n  {\r\n    title: '用户角色',\r\n    dataIndex: 'userRole',\r\n    search: true,\r\n    valueType:\"select\",\r\n    fieldProps: {\r\n      options: [\r\n        {label:\"普通用户\",value:\"0\"},\r\n        {\r\n          label: (\r\n            <span>\r\n              <span\r\n                style={{\r\n                  display: 'inline-block',\r\n                  width: 8,\r\n                  height: 8,\r\n                  borderRadius: '50%',\r\n                  backgroundColor: '#52c41a',\r\n                  marginRight: 6,\r\n                }}\r\n              />\r\n              管理员\r\n            </span>\r\n          ),\r\n          value:\"1\"\r\n        },\r\n      ]\r\n    },\r\n  },\r\n  {\r\n    title: '用户编码',\r\n    dataIndex: 'plantCode',\r\n  },\r\n  {\r\n    title: '创建时间',\r\n    key: 'showTime',\r\n    dataIndex: 'createTime',\r\n    valueType: 'date',\r\n    sorter: true,\r\n    hideInSearch: true,\r\n  },\r\n  {\r\n    title: '创建时间',\r\n    dataIndex: 'createTime',\r\n    valueType: 'dateRange',\r\n    hideInTable: true,\r\n    search: {\r\n      transform: (value) => {\r\n        return {\r\n          startTime: value[0],\r\n          endTime: value[1],\r\n        };\r\n      },\r\n    },\r\n  },\r\n  {\r\n    title: '操作',\r\n    valueType: 'option',\r\n    key: 'option',\r\n    render: (text, record, _, action) => [\r\n      <a\r\n        key=\"editable\"\r\n        onClick={() => {\r\n          action?.startEditable?.(record.id);\r\n        }}\r\n      >\r\n        编辑\r\n      </a>,\r\n      <a href={record.url} target=\"_blank\" rel=\"noopener noreferrer\" key=\"view\">\r\n        查看\r\n      </a>,\r\n      <TableDropdown\r\n        key=\"actionGroup\"\r\n        onSelect={() => action?.reload()}\r\n        menus={[\r\n          {key: 'copy', name: '复制'},\r\n          {key: 'delete', name: '删除'},\r\n        ]}\r\n      />,\r\n    ],\r\n  },\r\n];\r\n\r\nexport default () => {\r\n  const actionRef = useRef<ActionType>(null);\r\n  return (\r\n    <ProTable<API.CurrentUser>\r\n      columns={columns}\r\n      actionRef={actionRef}\r\n      cardBordered\r\n      request={async (params, sort, filter) => {\r\n        await waitTime(200);\r\n        const res = await queryUserList();\r\n        return {\r\n          data: res.data,\r\n          success: true,\r\n        };\r\n      }}\r\n      editable={{\r\n        type: 'multiple',\r\n      }}\r\n      columnsState={{\r\n        persistenceKey: 'pro-table-singe-demos',\r\n        persistenceType: 'localStorage',\r\n        defaultValue: {\r\n          option: {fixed: 'right', disable: true},\r\n        },\r\n        onChange(value) {\r\n          console.log('value: ', value);\r\n        },\r\n      }}\r\n      rowKey=\"id\"\r\n      search={{\r\n        labelWidth: 'auto',\r\n      }}\r\n      options={{\r\n        setting: {\r\n          listsHeight: 400,\r\n        },\r\n      }}\r\n      form={{\r\n        // 由于配置了 transform，提交的参数与定义的不同这里需要转化一下\r\n        syncToUrl: (values, type) => {\r\n          if (type === 'get') {\r\n            return {\r\n              ...values,\r\n              created_at: [values.startTime, values.endTime],\r\n            };\r\n          }\r\n          return values;\r\n        },\r\n      }}\r\n      pagination={{\r\n        pageSize: 5,\r\n        onChange: (page) => console.log(page),\r\n      }}\r\n      dateFormatter=\"string\"\r\n      headerTitle=\"高级表格\"\r\n      toolBarRender={() => [\r\n        <Button\r\n          key=\"button\"\r\n          icon={<PlusOutlined/>}\r\n          onClick={() => {\r\n            actionRef.current?.reload();\r\n          }}\r\n          type=\"primary\"\r\n        >\r\n          新建\r\n        </Button>,\r\n\r\n      ]}\r\n    />\r\n  );\r\n};\r\n"],"names":[],"mappings":"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"}